function formatsize(e){return e<=1e6&&(e=(e/1e3).toFixed(2)+" KB"),(1e6==e||e<=1e9)&&(e=(e/1e6).toFixed(2)+" MB"),(1e9==e||e<=1e12)&&(e=(e/1e9).toFixed(2)+" GB"),e}function file_delete(e,t,n){let i=new XMLHttpRequest,s=new FormData;s.append("file_delete",t),n&&s.append("sid",n),i.onreadystatechange=function(){4==this.readyState&&200==this.status&&(JSON.parse(i.responseText).fm_mod?get_file_list(n):get_file_list())},i.open("POST","core/file_manager.php"),i.send(s)}function gen_preview(e,t,n){return"jpg"==e||"png"==e||"gif"==e?"<img class='col-auto mb-3' style='border: 2px solid #46B7AA;' src='"+location.protocol+"//"+location.hostname+encodeURI("/storage/"+t+"/"+n)+"'></img>":"mp4"==e||"webm"==e?"<video controls class='col-auto mb-3' style='border: 2px solid #46B7AA; width:100%;' src='"+location.protocol+"//"+location.hostname+encodeURI("/storage/"+t+"/"+n)+"'></video>":"zip"==e?"<i style='color: #46B7AA;' class='h1 bi bi-file-earmark-zip-fill'></i>":"txt"==e?"<i style='color: #46B7AA;' class='h1 bi bi-filetype-txt'></i>":"<i style='color: #46B7AA;' class='h1 bi bi-file-earmark-text-fill'></i>"}function get_file_list(sid,name){let xmlhttp=new XMLHttpRequest,form=new FormData;form.append("file_list",""),sid&&form.append("sid",sid),xmlhttp.onload=function(){if(200==this.status){document.getElementById(sid?"filemb":"filemanager").innerHTML="";let da=JSON.parse(xmlhttp.responseText);da.spaceleft&&(document.getElementById("fldrop").innerHTML="",document.getElementById("stinf").innerHTML="",document.getElementById("aviable").innerHTML="(Доступно: "+formatsize(da.spaceleft)+")",document.getElementById("fldrop").innerHTML="Список файлов ("+da.storagecnt+"/"+da.storagemaxcnt+")",document.getElementById("stinf").innerHTML="Размер хранилища: "+formatsize(da.storagelimit));for(var myModal,row,i=0;row=da[i];i++){let counter,fid="file_"+eval(i+1);document.getElementById(sid?"filemb":"filemanager").innerHTML=document.getElementById(sid?"filemb":"filemanager").innerHTML+"<div class='card mb-4 text-black hoverscale stuser' style='border-radius:20px; width:200px; height:auto; cursor: pointer;overflow: hidden;'><div class='card-body'><div class='row p-1 mb-1'><div class='col'>"+gen_preview(row.extension,da.sid,row.name)+"<h6 class='title'>"+row.name+"</h6><h6 class='title' style='color:#46B7AA;'>Размер: "+row.size+"</h6></div></div></div><div class='btn-group'><button class='btn btn-outline-dark btn-sm border-start-0 border-bottom-0' title='Скопировать ссылку' onclick=\"navigator.clipboard.writeText(location.protocol+'//'+location.hostname+encodeURI('/storage/"+da.sid+"/"+row.name+"'))\"><i class='bi bi-share'></i></button><a title='Загрузить файл' class='btn btn-outline-dark btn-sm border-bottom-0' href='/storage/"+da.sid+"/"+row.name+"' download><i class='bi bi-cloud-arrow-down'></i></a><button class='btn btn-outline-dark btn-sm border-end-0 border-bottom-0' title='Удалить файл' onclick=\"file_delete('"+fid+"','"+row.name+(sid?"','"+sid:"")+"')\"><i class='bi bi-trash'></i></button></div>"}da.warn&&(document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Внимание!</strong> "+da.warn+".<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>"),sid&&name&&(new bootstrap.Modal(document.getElementById("filemanager_modal")).toggle(),document.getElementById("fm_lbl").innerHTML="Moderate "+name+"'s Files")}},xmlhttp.open("POST","core/file_manager.php"),xmlhttp.send(form)}if(document.getElementById("fileform").addEventListener("submit",e=>{e.preventDefault();let t=new FormData;t.append("file_submit",""),t.append("file",document.getElementById("file").files[0]);let n=new XMLHttpRequest;n.onload=()=>{try{let e=JSON.parse(n.responseText);e.error?document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Ошибка!</strong> "+e.error+"<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>":(document.getElementById("alertplace").innerHTML="",get_file_list())}catch(t){document.getElementById("alertplace").innerHTML="<div class='alert alert-danger alert-dismissible' role='alert'   data-aos='flip-right' data-aos-delay='100'><i class='bi bi-exclamation-triangle'> </i><strong>Ошибка!</strong> Файл слишком большой.<button type='button' class='btn-close' data-bs-dismiss='alert'></button></div>"}document.getElementById("progress").style.width="0%"},n.upload.onprogress=function(e){if(e.lengthComputable){var t=parseInt(e.loaded/e.total*100);console.log("Загрузка: "+t+"%..."),document.getElementById("progress").style.width=t+"%"}},n.open("POST","core/file_manager.php"),n.send(t)}),null!=document.getElementById("write_modal")){function toggleWritedrop(e){document.getElementById("write_selector").selected=e,document.getElementById("write_selector").innerHTML=e.innerHTML}function note_rm(e){let t=new XMLHttpRequest,n=new FormData;n.append("nrm",e),t.onload=function(){if(200==this.status){var e=JSON.parse(this.responseText);document.getElementById("writeralert").innerHTML="<div class='alert alert-success alert-dismissible mt-4' role='alert' data-aos='flip-right' data-aos-offset='50' data-aos-delay='100'><i class='bi bi-check2-circle'> </i><strong>Success!</strong> "+e.success+"<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button></div>",get_notes()}},t.open("POST","core/api.php"),t.send(n)}function note_edit(e){let t=new XMLHttpRequest,n=new FormData;n.append("get_tinydata",e),t.onload=function(){if(200==this.status){var t=JSON.parse(this.responseText);tinymce.activeEditor.modaledit=!0,tinymce.activeEditor.editingid=e,document.getElementById("iittl").classList.remove("d-none"),document.getElementById("iiimg").classList.remove("d-none"),document.getElementById("iinpttl").value=t.title,document.getElementById("iinpimg").value=t.headimg,document.getElementById("publish").innerHTML="Сохранить",new bootstrap.Modal(document.getElementById("write_modal")).toggle(),tinymce.activeEditor.execCommand("mceNewDocument"),tinymce.activeEditor.execCommand("mceInsertContent",!1,decodeURIComponent(escape(atob(t.content))))}},t.open("POST","core/api.php"),t.send(n)}function get_notes(){let xmlhttp=new XMLHttpRequest,form=new FormData;form.append("get_notes",""),xmlhttp.onload=function(){if(200==this.status){document.getElementById("notetable").innerHTML="";let da=JSON.parse(xmlhttp.responseText);for(var row,i=0;row=da[i];i++){let counter=eval(i+1);document.getElementById("notetable").innerHTML=document.getElementById("notetable").innerHTML+"<tr><th scope='row'>"+counter+"</th><td>"+row.type+"</td><td>"+row.title+"</td><td><div class='btn-group column-gap-1'><button title='Редактировать запись' class='btn btn-outline-dark btn-sm' onclick=\"note_edit('"+row.id+"')\"><i class='bi bi-pencil'></i></button><button class='btn btn-outline-dark btn-sm' title='Удалить запись' onclick=\"note_rm('"+row.id+"')\"><i class='bi bi-trash'></i></button></div></td></td></tr>"}}},xmlhttp.open("POST","core/api.php"),xmlhttp.send(form)}document.getElementById("write_modal").addEventListener("show.bs.modal",e=>{tinymce.activeEditor.modaledit||(document.getElementById("newstitle").classList.remove("is-invalid"),document.getElementById("newsheadimg").classList.remove("is-invalid"),document.getElementById("write_selector").classList.remove("btn-outline-danger"),document.getElementById("write_selector").selected?""==document.getElementById("newstitle").value?(e.preventDefault(),document.getElementById("newstitle").classList.add("is-invalid")):""==document.getElementById("newsheadimg").value?(e.preventDefault(),document.getElementById("newsheadimg").classList.add("is-invalid")):document.getElementById("modallbl").innerHTML="ultr4 "+document.getElementById("write_selector").selected.id+" wr1t3r 3000":(e.preventDefault(),document.getElementById("write_selector").classList.add("btn-outline-danger")),document.getElementById("iittl").classList.add("d-none"),document.getElementById("iiimg").classList.add("d-none"),document.getElementById("publish").innerHTML="Опубликовать",tinymce.activeEditor.execCommand("mceNewDocument"))}),document.getElementById("write_modal").addEventListener("hide.bs.modal",e=>{tinymce.activeEditor.modaledit=!1}),document.getElementById("publish").addEventListener("click",()=>{let e=new XMLHttpRequest,t=tinymce.get("tiny").getContent(),n=new FormData;tinymce.activeEditor.modaledit?(n.append("write_update",tinymce.activeEditor.editingid),n.append("headimg",document.getElementById("iinpimg").value),n.append("title",document.getElementById("iinpttl").value)):(n.append("write_save",document.getElementById("write_selector").selected.id),n.append("headimg",document.getElementById("newsheadimg").value),n.append("title",document.getElementById("newstitle").value)),n.append("content",t),e.open("POST","core/api.php"),e.onload=function(){let e=JSON.parse(this.responseText);document.getElementById("cancel").click(),e.success&&(get_notes(),document.getElementById("writeralert").innerHTML="<div class='alert alert-success alert-dismissible mt-4' role='alert'  data-aos='flip-right' data-aos-offset='50' data-aos-delay='100'><i class='bi bi-check2-circle'> </i><strong>Success!</strong> "+e.success+"<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button></div>")},e.send(n)}),document.addEventListener("focusin",function(e){null!==e.target.closest(".tox-tinymce-aux, .moxman-window, .tam-assetmanager-root")&&e.stopImmediatePropagation()})}let dropInput=document.getElementById("dropInput");if(null!=dropInput){function toggledrop(e){document.getElementById("optionDrop").innerHTML=e.innerHTML,selectedDrop=e;let t=new XMLHttpRequest,n=new FormData;n.append("settings_infoget",e.id),t.open("POST","core/api.php"),t.onreadystatechange=function(){200==this.status&&(dropInput.classList.remove("is-invalid"),dropInput.value=this.responseText.trim())},t.send(n)}function toggleswitch(e){let t=new XMLHttpRequest,n=new FormData;n.append("settings_insert",e.id),n.append("value",e.checked),t.open("POST","core/api.php"),t.onreadystatechange=function(){4==this.readyState&&this.status},t.send(n)}document.getElementById("saveDrop").addEventListener("click",()=>{if("undefined"==typeof selectedDrop)dropInput.value="Select option first!",dropInput.classList.add("is-invalid");else{let e=new XMLHttpRequest,t=new FormData;t.append("settings_insert",selectedDrop.id),t.append("value",dropInput.value),e.open("POST","core/api.php"),e.onreadystatechange=function(){4==this.readyState&&200==this.status&&"project_name"==selectedDrop.id&&(document.getElementById("project_name").innerHTML=dropInput.value)},e.send(t)}});let picker=document.getElementById("BGColorInput"),picker2=document.getElementById("BGColorInput2"),picker3=document.getElementById("BGColorInput3"),picker4=document.getElementById("BGColorInput4");document.addEventListener("input",function(e){if("color"==e.target.type&&(document.body.style.backgroundImage="linear-gradient(-45deg, "+picker.value+", "+picker2.value+", "+picker3.value+", "+picker4.value+")"),"file"==e.target.id){if(void 0!==file.files[0]){let t=formatsize(file.files[0].size);document.getElementById("uploadinf").classList.remove("d-none"),document.getElementById("filesize").innerHTML=t}else document.getElementById("uploadinf").classList.add("d-none")}}),document.getElementById("savebg").addEventListener("click",()=>{let e=new XMLHttpRequest,t=new FormData;t.append("settings_insert","bg_color"),t.append("value",picker.value+", "+picker2.value+", "+picker3.value+", "+picker4.value),e.open("POST","core/api.php"),e.send(t),document.body.style.backgroundImage="linear-gradient(-45deg, "+picker.value+", "+picker2.value+", "+picker3.value+", "+picker4.value+")"})}if(null!=document.getElementById("srv_form")){function server_rm(e){let t=new XMLHttpRequest,n=new FormData;n.append("svrm",e),t.onreadystatechange=function(){4==this.readyState&&200==this.status&&get_servers()},t.open("POST","core/api.php"),t.send(n)}function get_servers(){let xmlhttp=new XMLHttpRequest,form=new FormData;form.append("get_servers",""),xmlhttp.onload=function(){if(200==this.status){document.getElementById("servertable").innerHTML="",null!=document.getElementById("rcon_servs")&&(document.getElementById("rcon_servs").innerHTML="");let da=JSON.parse(xmlhttp.responseText);for(var row,i=0;row=da[i];i++){let counter=eval(i+1);document.getElementById("servertable").innerHTML=document.getElementById("servertable").innerHTML+"<tr><th scope='row'>"+counter+"</  th><td>"+row.sv_name+"</td><td>"+row.sv_ip+"</td><td>"+row.sv_port+"</td><td><button class='btn btn-outline-dark btn-sm' title='Удалить сервер' onclick=\"server_rm('"+row.sv_name+"')\"><i class='bi bi-trash'></i></button></td></td></tr>",null!=document.getElementById("rcon_servs")&&(document.getElementById("rcon_servs").innerHTML=document.getElementById("rcon_servs").innerHTML+"<option value="+row.id+">"+row.sv_name+"</option>")}}},xmlhttp.open("POST","core/api.php"),xmlhttp.send(form)}document.getElementById("srv_form").addEventListener("submit",e=>{e.preventDefault();let t=new XMLHttpRequest,n=new FormData(document.getElementById("srv_form"));n.append("svsave",""),t.addEventListener("load",e=>{get_servers()}),t.open("POST","core/api.php"),t.send(n)})}function nicedate(e){return(e=new Date(e)).toString().replace(/^[^\s]+\s([^\s]+)\s([^\s]+)\s([^\s]+)\s([^\s]+)\s.*$/ig,"$3-"+(e.getMonth()+1)+"-$2 $4").slice(0,-3)}null!=document.getElementById("rcon_submit")&&document.getElementById("rcon_submit").addEventListener("click",e=>{let t=new XMLHttpRequest,n=new FormData;n.append("rcon_submit",document.getElementById("rcon_servs").value),n.append("command",document.getElementById("rcon_string").value),document.getElementById("typer").classList.add("d-none"),t.onload=function(){let e=JSON.parse(t.responseText);document.getElementById("typer").classList.remove("d-none"),document.getElementById("rcon_response_place").innerHTML=">"+e.success},t.open("POST","core/rcon.php"),t.send(n)});